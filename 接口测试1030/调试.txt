*** Settings ***
Suite Teardown    Delete All Sessions
Library           requests
Library           json
Library           RequestsLibrary
Library           Collections
Library           demjson
Resource          ././PublicKW/CommentKW.txt
Resource          ././PublicRC/CommentRC.txt
Library           urllib2
Library           pic
Library           String
Library           Mytest01
Library           SmsService
Library           HttpLibrary.HTTP
Library           HttpLibrary
Library           ExcelLibrary

*** Test Cases ***
离线包下载校验
    [Documentation]    2017-12-08 \ author：liqiong
    ...
    ...    说明：
    ...
    ...    1.登录获取cookies；
    ...    2.固定一个主题，获取下载离线包数据，通过离线包的单号issue，查询下载状态，判断process=1，说明下载成功。
    #登录获取cookies
    ${data}    Create Dictionary    editor_name=${username}    remember=1    editor_password=${PWD}
    ${header}    Create Dictionary    content-type=${Type}
    Create Session    VR    ${URL}    ${header}
    ${Resp}    Post Request    VR    /web/user/login    data=${data}    headers=${header}
    #校验接口返回状态的正确性
    Check_API_Response    ${Resp}
    #下载离线包数据
    ${rest}    Get Request    VR    /api/output/resource/re?ids=${YM_ids}&auth=123
    Should Be Equal As Strings    ${rest.status_code}    200
    ###从列表中获取字典的值
    ${list}    Get Json Value    ${rest.text}    /data/issue
    ${issue_num}    Load Json    ${list}
    #循环判断下载的离线包是否成功
    : FOR    ${index}    IN RANGE    120
    \    sleep    3s
    \    ${flag}    Set Variable    0
    \    ${rest}    Get Request    VR    /api/output/resource/state?issue=${issue_num}&auth=123
    \    Should Be Equal As Strings    ${rest.status_code}    200
    \    ###从列表中获取字典的值
    \    ${list}    Get Json Value    ${rest.text}    /data/process
    \    ${process_mesg}    Load Json    ${list}
    \    Run Keyword If    '${process_mesg}'=='1.0'    Exit For Loop
    \    ${flag}    Set Variable    1
    ####
    Run Keyword If    '${flag}'=='1'    fail    10min还没有下载完成，有异常，请排查！！！
    ...    ELSE    log    离线包数据下载成功~~~
    Delete All Sessions
    [Teardown]

AR效果显示
    [Documentation]    2017-12-12 \ author：liqiong
    ...
    ...    说明：
    ...
    ...    1.新生成一个作品，校验是否有AR星级效果展示；判断完成后删除作品；
    #登录获取cookies
    ${data}    Create Dictionary    editor_name=${username}    remember=1    editor_password=${PWD}
    ${header}    Create Dictionary    content-type=${Type}
    Create Session    VR    ${URL}    ${header}
    ${rest}    Post Request    VR    /web/user/login    data=${data}    headers=${header}
    log    ${rest.cookies}
    #编辑图片
    ${infilename}    Set Variable    INstartTest.jpg
    ${outPicNname}    Set Variable    OUTstartTest.jpg
    log    编辑图片，创建一个不同的md5
    ${in_file}    Evaluate    open(r'${Dir}\INstartTest.jpg','rb')
    Save Image    ${in_file}    ${Dir}${outPicNname}
    log    上传图片
    @{list}    ComuploadPic    ${outPicNname}
    ${MD5}    Get From List    ${list}    0
    log    ${MD5}
    ${fileID}    Get From List    ${list}    1
    log    ${fileID}
    #创建之前先判断该作品是否存在，存在则删除。
    ${data}    Create Dictionary    md5=${MD5}    file_id=${fileID}
    Create Session    VR    ${URL}    ${header}    cookies=${rest.cookies}
    ${rest}    Post Request    VR    /web/irsearch    ${data}
    Should Be Equal As Strings    ${rest.status_code}    200
    ###从列表中获取字典的值
    ${list}    Get Json Value    ${rest.text}    /data/resource_list
    ${resource_list}    Load Json    ${list}
    ${lengthList}    Get Length    ${resource_list}
    log    ${lengthList}
    Run Keyword If    ${lengthList}!=0    Run Keyword    DeleteAR-BAK    ${rest.text}
    #登录获取cookies
    ${data}    Create Dictionary    editor_name=${username}    remember=1    editor_password=${PWD}
    ${header}    Create Dictionary    content-type=${Type}
    Create Session    VR    ${URL}    ${header}
    ${rest}    Post Request    VR    /web/user/login    data=${data}    headers=${header}
    log    ${rest.cookies}
    log    创建
    ${resourceID}    CreateAR    ${URL}    ${header}    ${rest.cookies}    ${MD5}
    log    ${resourceID}
    #查询AR效果效果
    log    根据md5查询AR效果效果是否显示成功
    : FOR    ${index}    IN RANGE    120
    \    sleep    3s
    \    ${flag}    Set Variable    0
    \    ${mesg}    Get Request    VR    /web/resource/fPoints/${MD5}
    \    log    ${mesg.text}
    \    Should Be Equal As Strings    ${mesg.status_code}    200
    \    ###从列表中获取字典的值
    \    ${list}    Get Json Value    ${mesg.text}    /status
    \    ${status}    Load Json    ${list}
    \    Run Keyword If    '${status}'=='success'    Exit For Loop
    \    ${flag}    Set Variable    1
    ####
    Run Keyword If    '${flag}'=='1'    fail    10min还没有显示星级，有异常，请排查！！！
    ...    ELSE    log    AR效果效果生成成功！！
    [Teardown]    DeleteResourceId    ${URL}    ${resourceID}    #

c
    [Documentation]    2017-12-08 \ author：liqiong
    ...
    ...    说明：
    ...
    ...    1.登录获取cookies；
    ...    2.固定一个主题，获取下载离线包数据，通过离线包的单号issue，查询下载状态，判断process=1，说明下载成功。
    #登录获取cookies
    log    登录获取cookies
    ${data}    Create Dictionary    editor_name=${username}    remember=1    editor_password=${PWD}
    ${header}    Create Dictionary    content-type=${Type}
    Create Session    VR    ${URL}    ${header}
    ${rest}    Post Request    VR    /web/user/login    data=${data}    headers=${header}
    log    ${rest.cookies}
    #编辑图片
    log    编辑图片
    ${infilename}    Set Variable    INstartTest.jpg
    ${outPicNname}    Set Variable    OUTstartTest.jpg
    log    编辑图片，创建一个不同的md5
    ${in_file}    Evaluate    open(r'${Dir}\INstartTest.jpg','rb')
    Save Image    ${in_file}    ${Dir}${outPicNname}
    log    上传图片
    @{list}    ComuploadPic    ${outPicNname}
    ${MD5}    Get From List    ${list}    0
    log    ${MD5}
    ${fileID}    Get From List    ${list}    1
    log    ${fileID}
    #创建之前先判断该作品是否存在，存在则删除。
    log    创建之前先判断该作品是否存在，存在则删除。
    ${data}    Create Dictionary    md5=${MD5}    file_id=${fileID}
    Create Session    VR    ${URL}    ${header}    cookies=${rest.cookies}
    ${rest}    Post Request    VR    /web/irsearch    ${data}
    Should Be Equal As Strings    ${rest.status_code}    200
    ###从列表中获取字典的值
    ${list}    Get Json Value    ${rest.text}    /data/resource_list
    ${resource_list}    Load Json    ${list}
    ${lengthList}    Get Length    ${resource_list}
    log    ${lengthList}
    Run Keyword If    ${lengthList}!=0    Run Keyword    DeleteAR-BAK    ${resultDic}    ${meg}
    #登录获取cookies
    ${data}    Create Dictionary    editor_name=${username}    remember=1    editor_password=${PWD}
    ${header}    Create Dictionary    content-type=${Type}
    Create Session    VR    ${URL}    ${header}
    ${rest}    Post Request    VR    /web/user/login    data=${data}    headers=${header}
    log    ${rest.cookies}
    log    创建
    ${resourseId}    CreateAR    ${URL}    ${header}    ${rest.cookies}    ${MD5}
    log    ${resourseId}
    #查询AR效果效果
    log    根据md5查询AR效果效果是否显示成功
    : FOR    ${index}    IN RANGE    120
    \    sleep    3s
    \    ${flag}    Set Variable    0
    \    ${mesg}    Get Request    VR    /web/resource/fPoints/${MD5}
    \    Should Be Equal As Strings    ${mesg.status_code}    200
    \    ###从列表中获取字典的值
    \    ${list}    Get Json Value    ${mesg.text}    /status
    \    ${status}    Load Json    ${list}
    \    Run Keyword If    '${status}'=='success'    Exit For Loop
    \    ${flag}    Set Variable    1
    ####
    Run Keyword If    '${flag}'=='1'    fail    10min还没有显示星级，有异常，请排查！！！
    ...    ELSE    log    AR效果效果生成成功！！
    [Teardown]    DeleteResourceId    ${resourseId}

22
    [Documentation]    2017-12-08 \ author：liqiong
    ...
    ...    说明：
    ...
    ...    1.登录获取cookies；
    ...    2.固定一个主题，获取下载离线包数据，通过离线包的单号issue，查询下载状态，判断process=1，说明下载成功。
    #输入合理的值校验接口返回值正确性
    ${Resp}    Login_web    /web/user/login
    #校验接口返回状态的正确性
    Check_API_Response    ${Resp}
    [Teardown]

admin端登录接口
    log    登录获取cookies
    #登录获取cookies
    ${data}    Create Dictionary    name=admin    password=2ideal#012
    ${header}    Create Dictionary    content-type=${Type}
    Create Session    VR    ${URL}    ${header}
    ${Resp}    Post Request    VR    /admin/user/login    data=${data}    headers=${header}
    log    ${Resp.cookies}
    ####
    Check_API_Response    ${Resp}
    ##作品分析
    ${Resp}    Get Request    VR    /web/resource/title/analysis?date_type=0&editor_id=5949e13740c6260006e517c3
    Check_API_Response    ${Resp}
    ${data_list}    Get Json Value    ${Resp.text}    /data
    ${data_list}    Load Json    ${data_list}
    ${collection_num}    Get From Dictionary    ${data_list}    collection_num    #点赞次数
    ${pv_h5_share_read_num}    Get From Dictionary    ${data_list}    pv_h5_share_read_num    #H5分享阅读
    ${pv_scan_num}    Get From Dictionary    ${data_list}    pv_scan_num    #扫描次数
    ${pv_share_num}    Get From Dictionary    ${data_list}    pv_share_num    #分享
    [Teardown]

admin端全部用户作品统计
    log    登录获取cookies
    #登录获取cookies
    ${data}    Create Dictionary    name=admin    password=2ideal#012
    ${header}    Create Dictionary    content-type=${Type}
    Create Session    VR    ${URL}    ${header}
    ${Resp}    Post Request    VR    /admin/user/login    data=${data}    headers=${header}
    log    ${Resp.cookies}
    ####
    Check_API_Response    ${Resp}
    ##作品分析
    ${Resp}    Get Request    VR    /web/resource/title/analysis?date_type=0&editor_id=5949e13740c6260006e517c3
    Check_API_Response    ${Resp}
    ${data_list}    Get Json Value    ${Resp.text}    /data
    ${data_list}    Load Json    ${data_list}
    ${collection_num}    Get From Dictionary    ${data_list}    collection_num    #点赞次数
    ${pv_h5_share_read_num}    Get From Dictionary    ${data_list}    pv_h5_share_read_num    #H5分享阅读
    ${pv_scan_num}    Get From Dictionary    ${data_list}    pv_scan_num    #扫描次数
    ${pv_share_num}    Get From Dictionary    ${data_list}    pv_share_num    #分享
    [Teardown]
